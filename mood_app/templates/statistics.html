<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* ===== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò ===== */
    :root {
      --primary: #9c4dff;
      --primary-dark: #7b2cbf;
      --primary-light: #c084fc;
      --dark: #0a0a0a;
      --darker: #000000;
      --surface: #1a1a1a;
      --surface-light: #2a2a2a;
      --text: #ffffff;
      --text-secondary: #cccccc;
      --accent: #ffffff;
      --gradient: linear-gradient(135deg, #9c4dff, #7b2cbf);
      --glow: 0 0 30px rgba(156, 77, 255, 0.5);
      --success: #4dff9c;
      --warning: #ffd166;
      --happy: #9c4dff;
      --calm: #4dabff;
      --sad: #7b2cbf;
      --angry: #ff4d4d;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: var(--dark);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      position: relative;
      overflow-x: hidden;
    }
    
    /* ===== –§–û–ù–û–í–´–ï –≠–§–§–ï–ö–¢–´ ===== */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 30%, rgba(156, 77, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(106, 27, 154, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(42, 10, 68, 0.15) 0%, transparent 70%);
      pointer-events: none;
      z-index: -2;
    }
    
    .floating-shapes {
      position: fixed;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      overflow: hidden;
    }
    
    .shape {
      position: absolute;
      border-radius: 50%;
      background: var(--primary);
      opacity: 0.05;
      filter: blur(40px);
    }
    
    .shape:nth-child(1) {
      width: 250px;
      height: 250px;
      top: 15%;
      left: 10%;
      background: #9c4dff;
    }
    
    .shape:nth-child(2) {
      width: 180px;
      height: 180px;
      bottom: 20%;
      right: 15%;
      background: #7b2cbf;
    }
    
    /* ===== –®–ê–ü–ö–ê ===== */
    .header-container {
      width: 100%;
      max-width: 1200px;
      text-align: center;
      margin-bottom: 2rem;
    }
    
    h1 {
      font-weight: 700;
      font-size: 3rem;
      letter-spacing: 1px;
      background: linear-gradient(90deg, var(--primary), var(--accent), var(--primary-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px rgba(156, 77, 255, 0.3);
      position: relative;
      padding-bottom: 15px;
      margin-bottom: 10px;
    }
    
    h1::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 200px;
      height: 3px;
      background: linear-gradient(90deg, 
        transparent, 
        var(--primary), 
        var(--accent), 
        var(--primary), 
        transparent
      );
      border-radius: 3px;
    }
    
    .subtitle {
      font-size: 1.2rem;
      color: var(--text-secondary);
      font-weight: 300;
      letter-spacing: 0.5px;
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
    }
    
    /* ===== –§–ò–õ–¨–¢–†–´ –ü–ï–†–ò–û–î–ê ===== */
    .filters-container {
      width: 100%;
      max-width: 1200px;
      background: rgba(26, 26, 26, 0.85);
      border-radius: 20px;
      padding: 1.5rem 2rem;
      margin-bottom: 2rem;
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      align-items: center;
      justify-content: space-between;
      border: 1px solid rgba(156, 77, 255, 0.2);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    
    .period-selector {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    
    .period-button {
      padding: 0.8rem 1.5rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(156, 77, 255, 0.3);
      border-radius: 12px;
      color: var(--text);
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }
    
    .period-button:hover {
      background: rgba(156, 77, 255, 0.1);
      border-color: var(--primary);
    }
    
    .period-button.active {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: var(--accent);
      border-color: var(--accent);
    }
    
    .date-range {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }
    
    .date-input {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(156, 77, 255, 0.3);
      border-radius: 12px;
      padding: 0.8rem 1rem;
      color: var(--text);
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      min-width: 150px;
      transition: all 0.3s ease;
    }
    
    .date-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 15px rgba(156, 77, 255, 0.3);
    }
    
    .apply-button {
      padding: 0.8rem 1.5rem;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border: none;
      border-radius: 12px;
      color: var(--accent);
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .apply-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(156, 77, 255, 0.3);
    }
    
    /* ===== –°–¢–ê–¢–ò–°–¢–ò–ö–ê –í –¶–ò–§–†–ê–• ===== */
    .stats-overview {
      width: 100%;
      max-width: 1200px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .stat-card {
      background: rgba(26, 26, 26, 0.85);
      border-radius: 20px;
      padding: 1.5rem;
      border: 1px solid rgba(156, 77, 255, 0.2);
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    
    .stat-card:hover {
      border-color: rgba(156, 77, 255, 0.4);
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(156, 77, 255, 0.1);
    }
    
    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      margin-bottom: 1rem;
    }
    
    .stat-icon.happy { background: linear-gradient(135deg, var(--happy), #c084fc); }
    .stat-icon.calm { background: linear-gradient(135deg, var(--calm), #93c5fd); }
    .stat-icon.sad { background: linear-gradient(135deg, var(--sad), #a78bfa); }
    .stat-icon.angry { background: linear-gradient(135deg, var(--angry), #fca5a5); }
    .stat-icon.summary { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); }
    
    .stat-value {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .stat-label {
      font-size: 1rem;
      color: var(--text-secondary);
      font-weight: 400;
    }
    
    .stat-trend {
      font-size: 0.9rem;
      margin-top: 0.5rem;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      display: inline-block;
    }
    
    .trend-up {
      background: rgba(77, 255, 156, 0.1);
      color: var(--success);
    }
    
    .trend-down {
      background: rgba(255, 77, 77, 0.1);
      color: #ff4d4d;
    }
    
    .trend-neutral {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-secondary);
    }
    
    /* ===== –ì–†–ê–§–ò–ö–ò ===== */
    .charts-container {
      width: 100%;
      max-width: 1200px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
    }
    
    @media (max-width: 1100px) {
      .charts-container {
        grid-template-columns: 1fr;
      }
    }
    
    .chart-card {
      background: rgba(26, 26, 26, 0.85);
      border-radius: 20px;
      padding: 1.5rem;
      border: 1px solid rgba(156, 77, 255, 0.2);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    
    .chart-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 1.5rem;
      color: var(--text);
      font-size: 1.3rem;
      font-weight: 600;
    }
    
    .chart-wrapper {
      position: relative;
      height: 300px;
      width: 100%;
    }
    
    /* ===== –ê–ù–ê–õ–ò–¢–ò–ö–ê ===== */
    .insights-container {
      width: 100%;
      max-width: 1200px;
      background: rgba(26, 26, 26, 0.85);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(156, 77, 255, 0.2);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    
    .insights-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 1.5rem;
      color: var(--text);
      font-size: 1.3rem;
      font-weight: 600;
    }
    
    .insights-list {
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
    }
    
    .insight-item {
      display: flex;
      align-items: flex-start;
      gap: 15px;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      border-left: 4px solid var(--primary);
      transition: all 0.3s ease;
    }
    
    .insight-item:hover {
      background: rgba(0, 0, 0, 0.4);
      transform: translateX(5px);
    }
    
    .insight-icon {
      color: var(--primary);
      font-size: 1.2rem;
      margin-top: 3px;
    }
    
    .insight-text {
      flex: 1;
      color: var(--text);
      line-height: 1.5;
    }
    
    .insight-highlight {
      color: var(--primary);
      font-weight: 600;
    }
    
    /* ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø ===== */
    .nav-container {
      display: flex;
      gap: 1.5rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .nav-link {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      color: var(--accent);
      text-decoration: none;
      font-size: 1.1rem;
      letter-spacing: 0.5px;
      padding: 1rem 1.8rem;
      border-radius: 50px;
      background: rgba(26, 26, 26, 0.7);
      border: 2px solid var(--primary);
      transition: all 0.4s ease;
      font-weight: 500;
      text-shadow: 0 0 8px rgba(156, 77, 255, 0.5);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
    }
    
    .nav-link:hover {
      color: var(--primary);
      border-color: var(--accent);
      text-shadow: 0 0 12px rgba(255, 255, 255, 0.7);
      transform: translateY(-5px);
      box-shadow: var(--glow), 0 12px 30px rgba(0, 0, 0, 0.7);
      background: rgba(26, 26, 26, 0.9);
    }
    
    .nav-link i {
      font-size: 1.2rem;
      transition: transform 0.3s ease;
    }
    
    .nav-link:hover i {
      transform: scale(1.2);
    }
    
    /* ===== –ê–ù–ò–ú–ê–¶–ò–ò ===== */
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .header-container {
      animation: slideUp 0.6s ease-out forwards;
    }
    
    .filters-container {
      animation: slideUp 0.6s ease-out 0.2s forwards;
      opacity: 0;
    }
    
    .stats-overview .stat-card {
      animation: slideUp 0.6s ease-out forwards;
      opacity: 0;
    }
    
    .stat-card:nth-child(1) { animation-delay: 0.3s; }
    .stat-card:nth-child(2) { animation-delay: 0.4s; }
    .stat-card:nth-child(3) { animation-delay: 0.5s; }
    .stat-card:nth-child(4) { animation-delay: 0.6s; }
    .stat-card:nth-child(5) { animation-delay: 0.7s; }
    
    .charts-container .chart-card {
      animation: slideUp 0.6s ease-out forwards;
      opacity: 0;
    }
    
    .chart-card:nth-child(1) { animation-delay: 0.8s; }
    .chart-card:nth-child(2) { animation-delay: 0.9s; }
    
    .insights-container {
      animation: slideUp 0.6s ease-out 1s forwards;
      opacity: 0;
    }
    
    /* ===== –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ ===== */
    @media (max-width: 768px) {
      body {
        padding: 1.5rem;
      }
      
      h1 {
        font-size: 2.5rem;
      }
      
      .subtitle {
        font-size: 1.1rem;
      }
      
      .filters-container {
        flex-direction: column;
        align-items: stretch;
        gap: 1rem;
      }
      
      .period-selector {
        justify-content: center;
      }
      
      .date-range {
        flex-direction: column;
        align-items: stretch;
      }
      
      .charts-container {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }
      
      .chart-card {
        padding: 1rem;
      }
      
      .chart-wrapper {
        height: 250px;
      }
      
      .stats-overview {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }
      
      .stat-value {
        font-size: 2rem;
      }
      
      .nav-container {
        flex-direction: column;
        width: 100%;
        max-width: 300px;
      }
    }
    
    @media (max-width: 480px) {
      h1 {
        font-size: 2rem;
      }
      
      .stats-overview {
        grid-template-columns: 1fr;
      }
      
      .period-selector {
        flex-direction: column;
      }
      
      .period-button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- –ü–ª–∞–≤–∞—é—â–∏–µ —Ñ–æ—Ä–º—ã –Ω–∞ —Ñ–æ–Ω–µ -->
  <div class="floating-shapes">
    <div class="shape"></div>
    <div class="shape"></div>
  </div>

  <!-- –®–∞–ø–∫–∞ -->
  <div class="header-container">
    <h1>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</h1>
    <p class="subtitle">–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–≤–æ–∏ —ç–º–æ—Ü–∏–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –∑–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</p>
  </div>

  <!-- –§–∏–ª—å—Ç—Ä—ã –ø–µ—Ä–∏–æ–¥–∞ -->
  <div class="filters-container">
    <div class="period-selector">
      <button class="period-button active" data-period="week">–ù–µ–¥–µ–ª—è</button>
      <button class="period-button" data-period="month">–ú–µ—Å—è—Ü</button>
      <button class="period-button" data-period="3months">3 –º–µ—Å—è—Ü–∞</button>
      <button class="period-button" data-period="year">–ì–æ–¥</button>
      <button class="period-button" data-period="all">–í—Å–µ –≤—Ä–µ–º—è</button>
    </div>
    
    <div class="date-range">
      <input type="date" class="date-input" id="start-date">
      <span>–ø–æ</span>
      <input type="date" class="date-input" id="end-date" value="{{ today }}">
      <button class="apply-button" id="apply-dates">
        <i class="fas fa-filter"></i>
        <span>–ü—Ä–∏–º–µ–Ω–∏—Ç—å</span>
      </button>
    </div>
  </div>

  <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="stats-overview">
    <div class="stat-card">
      <div class="stat-icon happy">
        <i class="fas fa-smile"></i>
      </div>
      <div class="stat-value" id="happy-count">0</div>
      <div class="stat-label">–†–∞–¥–æ—Å—Ç–Ω—ã—Ö –¥–Ω–µ–π</div>
      <div class="stat-trend trend-up" id="happy-trend">+5%</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon calm">
        <i class="fas fa-peace"></i>
      </div>
      <div class="stat-value" id="calm-count">0</div>
      <div class="stat-label">–°–ø–æ–∫–æ–π–Ω—ã—Ö –¥–Ω–µ–π</div>
      <div class="stat-trend trend-neutral" id="calm-trend">0%</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon sad">
        <i class="fas fa-sad-tear"></i>
      </div>
      <div class="stat-value" id="sad-count">0</div>
      <div class="stat-label">–ì—Ä—É—Å—Ç–Ω—ã—Ö –¥–Ω–µ–π</div>
      <div class="stat-trend trend-down" id="sad-trend">-2%</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon angry">
        <i class="fas fa-angry"></i>
      </div>
      <div class="stat-value" id="angry-count">0</div>
      <div class="stat-label">–ó–ª—ã—Ö –¥–Ω–µ–π</div>
      <div class="stat-trend trend-down" id="angry-trend">-8%</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon summary">
        <i class="fas fa-chart-line"></i>
      </div>
      <div class="stat-value" id="total-count">0</div>
      <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</div>
      <div class="stat-trend trend-up" id="mood-index">7.2/10</div>
    </div>
  </div>

  <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
  <div class="charts-container">
    <div class="chart-card">
      <div class="chart-header">
        <i class="fas fa-chart-pie"></i>
        <span>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π</span>
      </div>
      <div class="chart-wrapper">
        <canvas id="pieChart"></canvas>
      </div>
    </div>
    
    <div class="chart-card">
      <div class="chart-header">
        <i class="fas fa-chart-bar"></i>
        <span>–î–∏–Ω–∞–º–∏–∫–∞ –ø–æ –¥–Ω—è–º</span>
      </div>
      <div class="chart-wrapper">
        <canvas id="lineChart"></canvas>
      </div>
    </div>
  </div>

  <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –≤—ã–≤–æ–¥—ã -->
  <div class="insights-container">
    <div class="insights-header">
      <i class="fas fa-lightbulb"></i>
      <span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –≤—ã–≤–æ–¥—ã</span>
    </div>
    <div class="insights-list" id="insights-list">
      <div class="insight-item">
        <div class="insight-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="insight-text">
          –í–∞—à–µ –ø—Ä–µ–æ–±–ª–∞–¥–∞—é—â–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥: <span class="insight-highlight" id="dominant-mood">—Ä–∞–¥–æ—Å—Ç–Ω–æ–µ</span>
        </div>
      </div>
      
      <div class="insight-item">
        <div class="insight-icon">
          <i class="fas fa-calendar"></i>
        </div>
        <div class="insight-text">
          –°–∞–º—ã–π –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–π –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏: <span class="insight-highlight" id="best-day">–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</span>
        </div>
      </div>
      
      <div class="insight-item">
        <div class="insight-icon">
          <i class="fas fa-trend-up"></i>
        </div>
        <div class="insight-text">
          –¢–µ–Ω–¥–µ–Ω—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è: <span class="insight-highlight" id="mood-trend">—É–ª—É—á—à–∞–µ—Ç—Å—è</span> –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –ø–µ—Ä–∏–æ–¥–æ–º
        </div>
      </div>
      
      <div class="insight-item">
        <div class="insight-icon">
          <i class="fas fa-bullseye"></i>
        </div>
        <div class="insight-text">
          –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: <span class="insight-highlight" id="recommendation">–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å</span>
        </div>
      </div>
    </div>
  </div>

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <div class="nav-container">
    <a class="nav-link" href="{{ url_for('index') }}">
      <i class="fas fa-home"></i>
      <span>–ì–ª–∞–≤–Ω–∞—è</span>
    </a>
    <a class="nav-link" href="{{ url_for('journal') }}">
      <i class="fas fa-book-open"></i>
      <span>–î–Ω–µ–≤–Ω–∏–∫</span>
    </a>
    <a class="nav-link" href="{{ url_for('calendar') }}">
      <i class="fas fa-chart-line"></i>
      <span>–ì—Ä–∞—Ñ–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</span>
    </a>
    <a class="nav-link" href="{{ url_for('notifications') }}">
      <i class="fas fa-bell"></i>
      <span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
    </a>
  </div>

  <script>
    // –î–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
    let moodData = {{ records | tojson }};
    let currentPeriod = 'week';
    
    // –¶–≤–µ—Ç–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
    const moodColors = {
      happy: '#9c4dff',
      calm: '#4dabff',
      sad: '#7b2cbf',
      angry: '#ff4d4d'
    };
    
    const moodEmojis = {
      happy: 'üòä',
      calm: 'üòå',
      sad: 'üò¢',
      angry: 'üò†'
    };
    
    const moodNames = {
      happy: '–†–∞–¥–æ—Å—Ç–Ω—ã–π',
      calm: '–°–ø–æ–∫–æ–π–Ω—ã–π',
      sad: '–ì—Ä—É—Å—Ç–Ω—ã–π',
      angry: '–ó–ª–æ–π'
    };
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', () => {
      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      const today = new Date();
      const weekAgo = new Date();
      weekAgo.setDate(today.getDate() - 7);
      
      document.getElementById('start-date').value = weekAgo.toISOString().split('T')[0];
      document.getElementById('end-date').value = today.toISOString().split('T')[0];
      
      // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
      loadStatistics(currentPeriod);
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
      initializeCharts();
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      setupEventListeners();
    });
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
    function setupEventListeners() {
      // –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–∏–æ–¥–∞
      document.querySelectorAll('.period-button').forEach(button => {
        button.addEventListener('click', function() {
          document.querySelectorAll('.period-button').forEach(btn => {
            btn.classList.remove('active');
          });
          this.classList.add('active');
          
          currentPeriod = this.dataset.period;
          loadStatistics(currentPeriod);
        });
      });
      
      // –ö–Ω–æ–ø–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –¥–∞—Ç
      document.getElementById('apply-dates').addEventListener('click', () => {
        loadStatistics('custom');
      });
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function loadStatistics(period) {
      // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥
      // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
      const demoData = generateDemoData(period);
      updateStatistics(demoData);
      updateCharts(demoData);
      updateInsights(demoData);
    }
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö
    function generateDemoData(period) {
      const now = new Date();
      let startDate = new Date();
      
      switch(period) {
        case 'week':
          startDate.setDate(now.getDate() - 7);
          break;
        case 'month':
          startDate.setMonth(now.getMonth() - 1);
          break;
        case '3months':
          startDate.setMonth(now.getMonth() - 3);
          break;
        case 'year':
          startDate.setFullYear(now.getFullYear() - 1);
          break;
        case 'custom':
          const startInput = document.getElementById('start-date').value;
          const endInput = document.getElementById('end-date').value;
          startDate = new Date(startInput);
          break;
        case 'all':
        default:
          startDate = new Date('2024-01-01');
      }
      
      // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø–µ—Ä–∏–æ–¥—É
      const filteredData = moodData.filter(record => {
        const recordDate = new Date(record.stamp);
        return recordDate >= startDate;
      });
      
      // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –º–∞–ª–æ, –¥–æ–±–∞–≤–ª—è–µ–º –¥–µ–º–æ
      if (filteredData.length < 5) {
        return generateMockData(period);
      }
      
      return analyzeData(filteredData);
    }
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–∫-–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
    function generateMockData(period) {
      const moods = ['happy', 'calm', 'sad', 'angry'];
      const counts = {
        happy: Math.floor(Math.random() * 20) + 10,
        calm: Math.floor(Math.random() * 15) + 8,
        sad: Math.floor(Math.random() * 10) + 3,
        angry: Math.floor(Math.random() * 8) + 1
      };
      
      const total = Object.values(counts).reduce((a, b) => a + b, 0);
      const percentages = {};
      
      for (const mood in counts) {
        percentages[mood] = Math.round((counts[mood] / total) * 100);
      }
      
      // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –¥–Ω—è–º
      const days = period === 'week' ? 7 : period === 'month' ? 30 : 90;
      const dailyData = [];
      const dayNames = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
      
      for (let i = 0; i < days; i++) {
        const moodIndex = Math.floor(Math.random() * moods.length);
        const count = Math.floor(Math.random() * 3) + 1;
        dailyData.push({
          date: new Date(Date.now() - (days - i) * 24 * 60 * 60 * 1000),
          mood: moods[moodIndex],
          count: count
        });
      }
      
      return {
        counts: counts,
        percentages: percentages,
        total: total,
        dailyData: dailyData,
        period: period
      };
    }
    
    // –ê–Ω–∞–ª–∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    function analyzeData(data) {
      const counts = { happy: 0, calm: 0, sad: 0, angry: 0 };
      const dailyData = [];
      const dayCounts = {};
      
      data.forEach(record => {
        counts[record.mood]++;
        
        const date = new Date(record.stamp).toDateString();
        if (!dayCounts[date]) {
          dayCounts[date] = { happy: 0, calm: 0, sad: 0, angry: 0 };
        }
        dayCounts[date][record.mood]++;
      });
      
      // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ dailyData
      for (const date in dayCounts) {
        const dateObj = new Date(date);
        const moodCounts = dayCounts[date];
        const dominantMood = Object.keys(moodCounts).reduce((a, b) => 
          moodCounts[a] > moodCounts[b] ? a : b
        );
        
        dailyData.push({
          date: dateObj,
          mood: dominantMood,
          count: moodCounts[dominantMood]
        });
      }
      
      const total = Object.values(counts).reduce((a, b) => a + b, 0);
      const percentages = {};
      
      for (const mood in counts) {
        percentages[mood] = total > 0 ? Math.round((counts[mood] / total) * 100) : 0;
      }
      
      return {
        counts: counts,
        percentages: percentages,
        total: total,
        dailyData: dailyData.sort((a, b) => a.date - b.date),
        period: currentPeriod
      };
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function updateStatistics(data) {
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤
      document.getElementById('happy-count').textContent = data.counts.happy;
      document.getElementById('calm-count').textContent = data.counts.calm;
      document.getElementById('sad-count').textContent = data.counts.sad;
      document.getElementById('angry-count').textContent = data.counts.angry;
      document.getElementById('total-count').textContent = data.total;
      
      // –†–∞—Å—á–µ—Ç –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è (1-10)
      const moodIndex = Math.min(10, Math.max(1, 
        (data.counts.happy * 10 + data.counts.calm * 7 + data.counts.sad * 4 + data.counts.angry * 1) / data.total
      ));
      document.getElementById('mood-index').textContent = moodIndex.toFixed(1) + '/10';
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤ (–¥–µ–º–æ)
      const trends = {
        happy: Math.random() > 0.5 ? '+' + Math.floor(Math.random() * 15) + '%' : '-' + Math.floor(Math.random() * 10) + '%',
        calm: Math.random() > 0.5 ? '+' + Math.floor(Math.random() * 10) + '%' : '-' + Math.floor(Math.random() * 5) + '%',
        sad: Math.random() > 0.5 ? '+' + Math.floor(Math.random() * 8) + '%' : '-' + Math.floor(Math.random() * 12) + '%',
        angry: Math.random() > 0.5 ? '+' + Math.floor(Math.random() * 5) + '%' : '-' + Math.floor(Math.random() * 15) + '%'
      };
      
      document.getElementById('happy-trend').textContent = trends.happy;
      document.getElementById('calm-trend').textContent = trends.calm;
      document.getElementById('sad-trend').textContent = trends.sad;
      document.getElementById('angry-trend').textContent = trends.angry;
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤ —Ç—Ä–µ–Ω–¥–æ–≤
      for (const mood in trends) {
        const trendElement = document.getElementById(mood + '-trend');
        trendElement.className = 'stat-trend ';
        
        if (trends[mood].startsWith('+')) {
          trendElement.classList.add('trend-up');
        } else if (trends[mood].startsWith('-')) {
          trendElement.classList.add('trend-down');
        } else {
          trendElement.classList.add('trend-neutral');
        }
      }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
    let pieChart, lineChart;
    
    function initializeCharts() {
      const pieCtx = document.getElementById('pieChart').getContext('2d');
      const lineCtx = document.getElementById('lineChart').getContext('2d');
      
      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—â–∏—Ö –æ–ø—Ü–∏–π –¥–ª—è Chart.js
      Chart.defaults.color = '#cccccc';
      Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';
      
      // –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
      pieChart = new Chart(pieCtx, {
        type: 'doughnut',
        data: {
          labels: ['–†–∞–¥–æ—Å—Ç–Ω—ã–π', '–°–ø–æ–∫–æ–π–Ω—ã–π', '–ì—Ä—É—Å—Ç–Ω—ã–π', '–ó–ª–æ–π'],
          datasets: [{
            data: [25, 25, 25, 25],
            backgroundColor: [
              moodColors.happy,
              moodColors.calm,
              moodColors.sad,
              moodColors.angry
            ],
            borderWidth: 2,
            borderColor: 'rgba(0, 0, 0, 0.5)'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
              labels: {
                color: '#ffffff',
                font: {
                  size: 14
                },
                padding: 20
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `${context.label}: ${context.parsed}%`;
                }
              }
            }
          }
        }
      });
      
      // –õ–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫
      lineChart = new Chart(lineCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: []
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: {
                color: '#ffffff',
                font: {
                  size: 14
                }
              }
            }
          },
          scales: {
            x: {
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: '#cccccc'
              }
            },
            y: {
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: '#cccccc'
              }
            }
          }
        }
      });
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
    function updateCharts(data) {
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—Ä—É–≥–æ–≤–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
      pieChart.data.datasets[0].data = [
        data.percentages.happy,
        data.percentages.calm,
        data.percentages.sad,
        data.percentages.angry
      ];
      pieChart.update();
      
      // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª–∏–Ω–µ–π–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
      const labels = [];
      const moodValues = { happy: [], calm: [], sad: [], angry: [] };
      
      // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–Ω—è–º
      const dailyGroups = {};
      data.dailyData.forEach(item => {
        const dateStr = item.date.toLocaleDateString('ru-RU', { 
          month: 'short', 
          day: 'numeric' 
        });
        
        if (!dailyGroups[dateStr]) {
          dailyGroups[dateStr] = { happy: 0, calm: 0, sad: 0, angry: 0 };
        }
        dailyGroups[dateStr][item.mood] += item.count;
      });
      
      // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–∞—Ç
      const sortedDates = Object.keys(dailyGroups).sort((a, b) => {
        return new Date(a) - new Date(b);
      });
      
      // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ—á–µ–∫ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ
      const maxPoints = 15;
      const step = Math.max(1, Math.ceil(sortedDates.length / maxPoints));
      
      sortedDates.forEach((date, index) => {
        if (index % step === 0 || index === sortedDates.length - 1) {
          labels.push(date);
          moodValues.happy.push(dailyGroups[date].happy);
          moodValues.calm.push(dailyGroups[date].calm);
          moodValues.sad.push(dailyGroups[date].sad);
          moodValues.angry.push(dailyGroups[date].angry);
        }
      });
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–Ω–µ–π–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
      lineChart.data.labels = labels;
      lineChart.data.datasets = [
        {
          label: '–†–∞–¥–æ—Å—Ç–Ω—ã–π',
          data: moodValues.happy,
          borderColor: moodColors.happy,
          backgroundColor: moodColors.happy + '20',
          tension: 0.4,
          fill: true
        },
        {
          label: '–°–ø–æ–∫–æ–π–Ω—ã–π',
          data: moodValues.calm,
          borderColor: moodColors.calm,
          backgroundColor: moodColors.calm + '20',
          tension: 0.4,
          fill: true
        },
        {
          label: '–ì—Ä—É—Å—Ç–Ω—ã–π',
          data: moodValues.sad,
          borderColor: moodColors.sad,
          backgroundColor: moodColors.sad + '20',
          tension: 0.4,
          fill: true
        },
        {
          label: '–ó–ª–æ–π',
          data: moodValues.angry,
          borderColor: moodColors.angry,
          backgroundColor: moodColors.angry + '20',
          tension: 0.4,
          fill: true
        }
      ];
      lineChart.update();
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
    function updateInsights(data) {
      // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–µ–æ–±–ª–∞–¥–∞—é—â–µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
      let dominantMood = 'happy';
      let maxCount = 0;
      
      for (const mood in data.counts) {
        if (data.counts[mood] > maxCount) {
          maxCount = data.counts[mood];
          dominantMood = mood;
        }
      }
      
      document.getElementById('dominant-mood').textContent = 
        moodNames[dominantMood].toLowerCase();
      
      // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª—É—á—à–µ–≥–æ –¥–Ω—è (–¥–µ–º–æ)
      const days = ['–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–≤—Ç–æ—Ä–Ω–∏–∫', '—Å—Ä–µ–¥–∞', '—á–µ—Ç–≤–µ—Ä–≥', '–ø—è—Ç–Ω–∏—Ü–∞', '—Å—É–±–±–æ—Ç–∞', '–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'];
      const bestDay = days[Math.floor(Math.random() * days.length)];
      document.getElementById('best-day').textContent = bestDay;
      
      // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞
      const totalPositive = data.counts.happy + data.counts.calm;
      const totalNegative = data.counts.sad + data.counts.angry;
      
      let trend;
      if (totalPositive > totalNegative * 1.5) {
        trend = '—É–ª—É—á—à–∞–µ—Ç—Å—è';
      } else if (totalNegative > totalPositive * 1.5) {
        trend = '—É—Ö—É–¥—à–∞–µ—Ç—Å—è';
      } else {
        trend = '—Å—Ç–∞–±–∏–ª—å–Ω–æ';
      }
      document.getElementById('mood-trend').textContent = trend;
      
      // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
      let recommendation;
      if (dominantMood === 'happy') {
        recommendation = '–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Ä–∞–¥–æ–≤–∞—Ç—å—Å—è –∂–∏–∑–Ω–∏ –∏ –¥–µ–ª–∏—Ç—å—Å—è –ø–æ–∑–∏—Ç–∏–≤–æ–º!';
      } else if (dominantMood === 'calm') {
        recommendation = '–í–∞—à–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ - –≤–∞—à–∞ —Å–∏–ª–∞. –ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –º–µ–¥–∏—Ç–∞—Ü–∏—é';
      } else if (dominantMood === 'sad') {
        recommendation = '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –±–æ–ª—å—à–µ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –ª—é–±–∏–º—ã–º–∏ –¥–µ–ª–∞–º–∏';
      } else {
        recommendation = '–ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è —Å–Ω—è—Ç–∏—è –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è';
      }
      document.getElementById('recommendation').textContent = recommendation;
    }
    
    // –ü–∞—Ä–∞–ª–ª–∞–∫—Å —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö —Ñ–æ—Ä–º
    window.addEventListener('mousemove', (e) => {
      const shapes = document.querySelectorAll('.shape');
      const mouseX = e.clientX / window.innerWidth;
      const mouseY = e.clientY / window.innerHeight;
      
      shapes.forEach((shape, index) => {
        const speed = 0.3 + (index * 0.2);
        const x = (mouseX * 15 * speed) - 7.5;
        const y = (mouseY * 15 * speed) - 7.5;
        
        shape.style.transform = `translate(${x}px, ${y}px)`;
      });
    });
  </script>
</body>
</html>